[toc]

- 临时执行命令`:!command`
- 带有`:`的表示在命令行中输入的内容（善用<kbd>Tab</kdb>）
  - 多条指令使用`|`分隔

# 打开及保存

- 创建当前文件的所有上层目录  `:!mkdir -p %h`

  vim打开文件（也可能是新建文件）时，输入了不正确的路径，可以先用以上命令创建文件夹，保存退出后再移动文件到正确的位置。

- 普通用户编辑时临时启用sudo保存文件`:!w sudo tee %`

  `%`是vim当中一个只读寄存器的名字，该寄存器总保存着当前编辑文件的文件路径。

## buffer  文件缓冲区

打开一个文件后内容加载到一个缓冲区中

- `:ls`  列出当前缓冲区
- 从缓冲区重新载入`:e`
  - `:e {filename}`  打开一个新的文件
    - 放弃当前更改从缓冲区重新载入`:!e`
  - 切换到指定缓冲区
    - `:b n` 跳到第n个缓冲区（从1开始编号）
    - `:b 缓冲区名字`  可以使用<kbd>Tab</kbd>补全缓冲区名字
    - `:bp`或`:bprevious` 和`:bl`或`:blast`  上一个或下一个缓冲区

## window  窗口

一个缓冲区可以分隔为多个窗口，每个窗口可以切换不同缓冲区。

窗口操作如果使用快捷键，均以<kbd>Ctrl</kbd><kbd>w</kbd>为前缀，其后按下其他操作按键，以下以`<c-w>` 代指<kbd>Ctrl</kbd><kbd>w</kbd>。

- 分割
  - 水平`<c-w>` `s` 或`:sp`
  - 垂直`<c-w>` v或`:vs`

- 切换
  - `<c-w>` `w`  窗口间循环切换
  - `<c-w>` `h `/ `j` / `k` / `l`  上/下/左/右切换窗口
- 移动
  - `<c-w>`  `H`  / `J` / `K` / `L` 上/下/左/右移动窗口
  - `<c-w> T`  移动当前窗口到一个新的标签页

## tab

用来组织多个窗口。

- 打开或关闭

  - 新标签页中打开文件  `tabe[dit] {filename}`或`tabenew {filename}` 

    如果没有输入文件名则新建一个文件并打开。

  - `tabc[close]`  关闭当前标签页及其中的窗口

    - `tabo[nly]`  关闭除了活动标签页之外的所有标签页

- 切换
  - `gt`或`gT`  切换下一个或上一个标签页
  - `:tabn {n}`  切换到指定编号n的标签页=

# 折叠和展开

- `zo`  展开 `zc`  折叠
- `zn`  全部展开 `zN`  全部折叠

# 光标或页面移动

## 单词间移动

大小写按键的区别，小写以非空白符号为单词分隔符（IFS），大写以空白符为单词分隔符。

- `w` `W`  移动到下一单词开头的字符
- `b` `B`  移动到上一单词开头的字符
- `e` `E`  移动到下一单词结尾的字符

## 行内移动

- `j` `k`  移动到 左 右 字符上

  数字 n+ 左右按键：光标移动到第n个字符上

- 行首或行尾
  - `0`  移动到行首字符上
  - `$`  移动到行尾字符上
  - `^`  移动本行第一个非空白字符上（如果第一字符是空白字符，可使用`0` `w`实现`^`效果）
  - `g_`  移动到本行最后一个非空白字符上

- 搜索字符并移动

  大写的按键的移动方向于小写按键相反（反向搜索匹配并移动）

  - `f{char}`  移动到匹配的字符char上（f--`find`搜索{char}字符并移动光标到第一个匹配的字符）
  - `F{char}`
  - `t{char}` 移动到匹配字符的前一个字符上（t可助记为`until`）
  - `T{char}`

  例如一行内容为`aaaaxbbbyx`，执行`fx`光标将移动到字符`x`上，执行`fy`光标移动到y前面的字符`b`上。

## 行间或页面移动

- `h` `l`  上下移动

  数字n + 上下按键：光标移动n行

- `gg` `G`  移动到文件 首行 末行

- `:n` 或`n`+<kbd>Shift</kbd><kbd>g</kbd> 移动到第n行

- 按屏幕行移动

  当一行内容（实际行）长度超出屏幕一行所能显示的长度时，内容会折行显示，显示的每一行就是一屏幕行。

  - `g0`与`g$`  分别为移动到屏幕行的首行与移动到屏幕行尾行
  - `gj`与`gk`  分别为下移动一屏幕行和上移动一屏幕行

- <kbd>Ctrl</kbd> <kbd>o</kbd>  返回光标上次所在的行

- `H` `M` `L`  分别移动到当前页面的开头(head) 中间(middle) 结尾(last)

- <kbd>Ctrl</kbd> <kbd>u</kbd>  上翻页(upward)  <kbd>Ctrl</kbd> <kbd>f</kbd>  下翻页(forward)

- `zz`  将当前行显示为页面中间行（滚动页面，让当前行上下居中）



# 格式排版

- 自动对齐（格式化排版）
  - 选中内容对齐：可视模式或鼠标选中内容后按下`=`
  - 全文自动对齐：正常模式按下`gg=G`
- 排序`:sort`

# 文本编辑

参看[vim-modes](vim-modes.md)

- `aw`和`iw`  around word会包含单词前的空白字符   inner word只包含单词本身

## 选择

v模式

- `viw`和`vaw`  选择单词

- `vi{char}`  选择成对字符中的内容

  例如`aa"xxx"zz` ，执行`vi"`选中双引号之间的内容。

## 增加

从普通模式进入插入模式。

`i` `I` `a` `A` `o` `O`

## 删除

- 全文删除 `ggdG` 或 `Gdgg`
- 行删除`dd`
- 删除单词`dw` 
  - `daw` 和`diw`删除单词，包含空格 delete around word
- 行内删除
  - 从当前位置删除到行首`d0`
  - 从当前位置删除到行尾`d$`或`D`

## 修改

- `r`  进入替换模式，替换完一个字符并恢复为普通模式

  -  `R`  一直处于替换模式除非按下`Esc`

- `c`  change 执行某个修改操作并进入插入模式

  - `cw`  修改单词change word

  - `caw`  修改单词，包括空白符 

  - `C`  删除当前字符到行尾所有字符并进入插入模式

  - `ci{char}`  删除成对的两个char字符之间的内容并进入编辑模式（多行也适用）

    例如：`aa[bbbbb]cccc`，执行`ci[`将删除`[]`内的内容

    例如：

    > {
    >
    > "a":123,
    >
    > "b":456
    >
    > }

    执行`ci{`将删除`{}`之间的内容。

- `s`  修改谋个字符substitute 删除当前字符并进入插入模式

  - `S`  删除本行并进入插入模式
  - 数字n+`s` 删除n个字符并进入插入模式

## 多行编辑

### 多行注释示例

以`#`为注释符号为例。 

- 选中要修改的行，按下`:` ，输入指令`normal I#`。
- 选中要修改的行，按下`:` ，输入指令`s/^/#/`。
- 使用[宏](#宏)：录制宏a，内容为`I#`，选择需要注释的行回放该宏，或者执行执行:`m,n normal @a`。

### 编辑多行的同一区块

1. <kbd>Ctrl</kbd><kbd>v</kbd>配合方向键/定位键等（如`G`、`$`）选中区块

2. 根据不同的修改模式执行操作

   - 替换：

     1. `r`

     2. 输入替换内容后直接完成替换

   - 插入：

     1. 执行前插入I 或者 后插入A

     2. 输入要插入的内容
3. <kbd>Esc</kbd>完成编辑，再次<kbd>Esc</kbd>将新插入内容应用到所有行。

### 精确匹配替换

使用`\<string\>`精确匹配string

```shell
% s/\<old\>/new/g  #只会匹配old单词，类似aold或oldz的单词不会被匹配并替换
```

# 寄存器

## 寄存器分类

Vim 支持的寄存器非常多，可使用命令`:reg` 查看所有寄存器及其内容或`:reg [register_name]` 查看指定寄存器(register_name)的内容。

部分寄存器如下：

- `"a-"z` `"A-"Z` 用户寄存器，vim不会读写

- `""` 未命名寄存器，为Vim 的默认寄存器，例如删除、复制等操作的内容都会被保存到这里（每次新内容将覆盖旧内容）。

- `"+` 剪切板寄存器，映射系统剪切板，保存在这个寄存器中的内容可以被系统其他程序访问。

  需要vim支持clipboard功能，执行`vim --version|grep +clipboard`查看当前vim是否支持该功能，如不支持可安装其他版本的vim如gvim。

- `"*`  鼠标选中内容寄存器，存储图形界面中鼠标框选的内容（一般可以使用鼠标中键粘贴）

-  `"0-"9` 数字寄存器，是 Vim 用来保存最近复制、删除等操作的内容， 0 号寄存器保存的是最近一次的操作内容。

- `"%` 只读寄存器，存储了当前编辑的文件的名字

- `"#` 只读寄存器

## 复制粘贴

- `yiw` `yaw`

- 粘贴内容缩进混乱问题

  可使用这些方法：

  - 使用`"+p`粘贴
  - 设置 paste后粘贴
    1. normal模式下执行`:set paste`
    2. insert模式下粘贴内容
    3. normal模式下执行`:set nopaste` 恢复行为

- `"ayy`   复制当前行到寄存器 a
- `"ap`   粘贴寄存器 a 中的内容
- `"%p`  粘贴寄存器`%`内容



## vim中操作系统剪切板

在正常模式(normal mode)下输入相关指令，指令由寄存器名字和编辑命令（`y` `p`等）组成，如`"%p`：`"%`为寄存器名字，`p`为粘贴命令（粘贴寄存器`%`的内容），例如：

设置`:set clipboard^=unnamed`，执行`y` `d` `x` `p`就可以赋值粘贴系统剪切版内容，使用vim命令`: 'clipboard'`查看相关说明。

- `"+y`  复制选中内容（例如用<kbd>Ctrl</kbd><kbd>v</kbd>选中）到剪切板
  - `"+yy`  复制当前行到剪切板
- `"+p`    将剪切板内容粘贴到光标后面

`"*p`同理。



# 宏

一系列命令的集合。先录制，然后回放。

- 录制  在normal模式下

  - 开始：`q{register}` 选择将宏保存到指定寄存器（例如任意一个用户寄存器）
  - 结束：`q`

- 回放：`@{register}` 或者在命令中执行`normal @{register}`

  在指定行回放宏（对于多行播放行，可使用v模式选中多行后在命令中执行回放操作。

# 补全

在编辑状态下`C-`表示按下<kbd>Ctrl</kbd>加其他按键。

- `C-n` 普通关键字
- `C-x C-n`  当前缓冲区关键字
  - <kbd>Ctrl</kbd><kbd>p</kbd>
- file name
  - ctrl x 
  - ctrl f
- code
  - ctrl x
  - ctrl o  (enable file type checking and plugin)



